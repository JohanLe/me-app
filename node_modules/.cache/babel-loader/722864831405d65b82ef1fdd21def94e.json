{"ast":null,"code":"import _classCallCheck from\"/Users/ledel/WebbServer/dbwebb-kurser/jsramverk/me/app/me-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/ledel/WebbServer/dbwebb-kurser/jsramverk/me/app/me-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/ledel/WebbServer/dbwebb-kurser/jsramverk/me/app/me-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/ledel/WebbServer/dbwebb-kurser/jsramverk/me/app/me-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/ledel/WebbServer/dbwebb-kurser/jsramverk/me/app/me-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import ReportQuestion from'./ReportQuestion.js';var ReportEdit=/*#__PURE__*/function(_React$Component){_inherits(ReportEdit,_React$Component);function ReportEdit(props){var _this;_classCallCheck(this,ReportEdit);_this=_possibleConstructorReturn(this,_getPrototypeOf(ReportEdit).call(this,props));_this.getReport=function(){fetch(\"http://localhost:8333/reports/\"+_this.state.kmom,{method:\"GET\",headers:{'Accept':'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(res){if(res.data){var parsed=JSON.parse(res.data.text);var data=parsed.map(function(item,index){item['id']=index;return item;});_this.setState({reportData:data});_this.setState({editFields:_this.createReportQuestion(data)});}});};_this.postReport=function(data){fetch(\"http://localhost:8333/reports\",{method:\"POST\",headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify({kmom:_this.state.kmom,data:data,token:localStorage.getItem('jwt')})}).then(function(res){return res.json();}).then(function(res){console.log(res);if(res.data.status==='ok'){var url='/reports/week/'+_this.state.kmom;window.location.replace(url);}});};_this.createReportQuestion=function(data){var questions=data.map(function(item,index){return React.createElement(ReportQuestion,{key:index,index:item.id,question:item.question,answer:item.answer,triggerQuestion:_this.handleOnChange,triggerAnswer:_this.handleOnChange});});var newData=_this.state.editFields;newData.push(questions);_this.setState({editFields:newData});};_this.addQuestion=function(event){if(event){event.preventDefault();}var item={id:_this.state.reportData.length,question:\"New\",answer:\"New\"};_this.createReportQuestion([item]);var newState=_this.state.reportData;newState.push(item);_this.setState({reportData:newState});};_this.handleSubmit=function(event){event.preventDefault();_this.postReport(JSON.stringify(_this.state.reportData));};_this.handleOnChange=function(event){var nam=event.target.name;var val=event.target.value;var id=event.target.id;var state=_this.state.reportData;var newState=[];state.forEach(function(item){if(item.id===id){item[nam]=val;}newState.push(item);});_this.setState({reportData:newState});};_this.state={kmom:_this.props.match.params.kmom,reportData:[],editFields:[]};_this.getReport();return _this;}_createClass(ReportEdit,[{key:\"render\",value:function render(){return React.createElement(\"div\",{className:\"edit_report_container\"},React.createElement(\"form\",{className:\"edit-question-form\",onSubmit:this.handleSubmit},React.createElement(\"div\",null,this.state.editFields),React.createElement(\"button\",{onClick:this.addQuestion},\"Add question\"),React.createElement(\"input\",{type:\"submit\",value:\"Spara\"})));}}]);return ReportEdit;}(React.Component);export default ReportEdit;","map":{"version":3,"sources":["/Users/ledel/WebbServer/dbwebb-kurser/jsramverk/me/app/me-app/src/js/components/ReportEdit.js"],"names":["React","ReportQuestion","ReportEdit","props","getReport","fetch","state","kmom","method","headers","then","res","json","data","parsed","JSON","parse","text","map","item","index","setState","reportData","editFields","createReportQuestion","postReport","body","stringify","token","localStorage","getItem","console","log","status","url","window","location","replace","questions","id","question","answer","handleOnChange","newData","push","addQuestion","event","preventDefault","length","newState","handleSubmit","nam","target","name","val","value","forEach","match","params","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ReportQuestion from './ReportQuestion.js';\n\nclass ReportEdit extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            kmom: this.props.match.params.kmom,\n            reportData: [],\n            editFields: [],\n        };\n        this.getReport();\n    \n    }\n\n    getReport = () => {\n        fetch(\"http://localhost:8333/reports/\" + this.state.kmom, {\n            method: \"GET\",\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json',\n            },\n        }).then((res) => {\n            return res.json();\n        }).then((res) => {\n            if(res.data){\n                var parsed = JSON.parse(res.data.text);\n                var data = parsed.map((item, index) => {\n                    item['id'] = index;\n                    return item;\n                });\n               \n                this.setState({reportData: data});\n                this.setState({editFields: this.createReportQuestion(data)})\n                \n            }\n     \n        });\n    };\n    postReport = (data) => {\n        \n        fetch(\"http://localhost:8333/reports\", {\n            method: \"POST\",\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n                kmom: this.state.kmom,\n                data: data,\n                token: localStorage.getItem('jwt')\n            })\n        }).then((res) => {\n            return (res.json());\n\n        }).then((res) => {\n            console.log(res);\n            if(res.data.status === 'ok'){\n                var url = '/reports/week/' + this.state.kmom;\n                window.location.replace(url);\n            }\n        })\n\n    };\n\n    createReportQuestion = (data) => {\n        var questions = data.map((item, index) => {\n            return (\n                <ReportQuestion\n                    key={index}\n                    index={item.id}\n                    question={item.question}\n                    answer={item.answer}\n                    triggerQuestion={this.handleOnChange}\n                    triggerAnswer={this.handleOnChange}\n                />\n            );\n        });\n        var newData = this.state.editFields;\n        newData.push(questions);\n        this.setState({editFields: newData});\n    };\n    addQuestion = (event) => {\n        if (event) {\n            event.preventDefault();\n        }\n        var item  = {id:(this.state.reportData.length), question: \"New\", answer: \"New\"};\n        this.createReportQuestion([item]);\n        var newState = this.state.reportData;\n        newState.push(item);\n        this.setState({reportData: newState});\n    };\n\n    handleSubmit = (event) => {\n        event.preventDefault();\n        this.postReport(JSON.stringify(this.state.reportData));\n    };\n\n    handleOnChange = (event) => {\n\n        let nam = event.target.name;\n        let val = event.target.value;\n        let id = event.target.id;\n        var state = this.state.reportData;\n        var newState = [];\n        state.forEach((item)=>{\n            if(item.id === id){\n                item[nam] = val;\n            }\n            newState.push(item);\n\n        });\n        this.setState({reportData: newState});\n    };\n\n\n    render() {\n        return (\n            <div className=\"edit_report_container\">\n\n                <form className=\"edit-question-form\" onSubmit={this.handleSubmit}>\n                    <div>\n                        {this.state.editFields}\n                    </div>\n                    <button onClick={this.addQuestion}>Add question</button>\n                    <input type=\"submit\" value=\"Spara\"/>\n                </form>\n\n            </div>\n\n        )\n    }\n\n}\n\nexport default ReportEdit;\n\n"]},"metadata":{},"sourceType":"module"}